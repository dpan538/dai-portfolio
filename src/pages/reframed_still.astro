---
import BaseLayout from "../layouts/base_layout.astro";

const page_title = "Reframed Still";
const page_description =
    "A photographic sequence that reframes stillness through a curated strip of images, slowing the gaze across cities and time.";

const images = Array.from({ length: 8 }, (_, i) => {
    const n = String(i + 1).padStart(2, "0");
    return `/projects/reframed_still/reframed${n}.jpg`;
});

const SITE_URL = "https://daipan.art";
const meta = {
    title: page_title,
    description: page_description,
    og_image: images[0],
    canonical: `${SITE_URL}/reframed_still`,
};
const breadcrumbs = [{ name: "Home", url: SITE_URL }, { name: "Reframed Still", url: `${SITE_URL}/reframed_still` }];

const project = {
    title: "Reframed Still",
    medium: "Gelatin Silver Print",
    locations: ["New York", "Guangzhou", "Shanghai", "Nantong"],
    years: "2021 — 2025",
    note: "A sequence that reframes stillness through a curated strip of images, slowing the gaze across cities and time. Moments of quiet and pause within the flow of urban life; light, shadow, and composition unfold gradually as one moves through the strip.",
};

const frameHints = [
    "A pause in the flow.",
    "Light through the window.",
    "Evening.",
    "Still.",
    "Between cities.",
    "A moment held.",
    "Light and shadow.",
    "Where the gaze rests.",
];
---

<style>
    :root {
        --bg: #ffffff;
        --fg: #111111;
        --muted: rgba(0, 0, 0, 0.62);
        --muted2: rgba(0, 0, 0, 0.52);
        --line: #e9e9e9;

        --gap: 56px;
        --strip_h: 72vh;
        --side_pad: 10vw;
    }

    body {
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        overflow-x: hidden;
    }

    /* Page layout: above strip (like Quite Off stock line) | strip | hint bar below (like ← hint →) */
    .reframed-page {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
    }

    /* 微调：负的 margin-top 使文案上移；后续可改 --strip-intro-nudge（单位 px） */
    .strip-intro-hint {
        flex-shrink: 0;
        margin: 0 0 16px;
        margin-top: -12px;
        padding-top: 0;
        font-size: 0.8rem;
        color: var(--muted);
        text-align: center;
    }

    .strip-wrap {
        flex: 1;
        min-height: 0;
        overflow: hidden;
    }

    /* Main gallery strip */
    .strip {
        height: 100%;
        display: flex;
        align-items: flex-start;
        padding-top: 16px;
        padding-bottom: 16px;
        overflow-x: auto;
        overflow-y: hidden;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
        padding-left: clamp(24px, 6vw, 72px);
        padding-right: clamp(24px, 6vw, 72px);
        gap: var(--gap);
    }

    /* Hide scrollbar gently (optional) */
    .strip::-webkit-scrollbar {
        height: 10px;
    }
    ::-webkit-scrollbar-track {
        background: transparent;
    }
    .strip::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.12);
        border-radius: 999px;
    }

    figure.frame {
        margin: 0;
        height: var(--strip_h);
        flex: 0 0 auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
    }

    figure.frame img {
        height: 100%;
        width: auto;
        max-height: var(--strip_h);
        border: 1px solid transparent;
        box-sizing: border-box;
    }

    figure.frame:hover img {
        border-color: var(--line);
    }

    /* Hint bar 固定在视口底部，与侧栏图标同一水平线，确保始终可见 */
    .strip-hint-bar {
        position: fixed;
        bottom: 48px;
        left: 320px;
        right: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 22px;
        padding: 10px 0;
        flex-shrink: 0;
        z-index: 10;
    }

    .strip-hint-bar span {
        font-size: 0.8rem;
        color: var(--muted);
    }

    #reframed-hint-text {
        min-width: 12ch;
    }

    @media (max-width: 820px) {
        .strip-hint-bar {
            left: 0;
            bottom: 24px;
        }
    }

    /* Description section at the end (vertical normal) */
    .desc {
        padding: 64px var(--side_pad) 96px;
        max-width: 980px;
    }

    .desc h1 {
        font-size: 22px;
        font-weight: 600;
        margin: 0 0 14px;
        letter-spacing: 0.2px;
    }

    .meta {
        font-size: 15px; /* 从 13 提到 15 */
        line-height: 1.7;
        margin-bottom: 18px;
    }

    .meta strong {
        color: var(--fg);
        font-weight: 600;
    }

    .desc p {
        font-size: 15px;
        line-height: 1.85;
        color: var(--muted2);
        margin: 0;
    }

    :global(main.content) {
        padding: 0 !important;
        max-width: none !important;
        margin-inline: 0 !important;
        height: 100vh;
        overflow: hidden;
    }

    :global(main.content:has(.reframed-page)) {
        padding-top: 88px !important;
        padding-bottom: 48px !important;
    }

    :global(main.content > *) {
        max-width: none !important;
    }

    .strip-wrap .strip {
        width: 100%;
    }

    /* 右划到底出现的项目说明：调 padding 可控制与上/右/下/左的距离 */
    .desc_panel {
        flex: 0 0 auto;
        height: 72vh;
        width: min(560px, 78vw);
        position: relative;
        background: transparent;
        padding: 72px 40px 40px 40px; /* 上 右 下 左：想再往下就增大第一个数 */
        box-sizing: border-box;
    }

    .desc_panel h3 {
        font-size: 1rem;
        font-weight: 600;
        margin: 0 0 12px;
        letter-spacing: 0.04em;
    }

    .desc_panel .meta {
        font-size: 0.85rem;
        line-height: 1.6;
        margin-bottom: 16px;
        color: var(--muted);
    }

    .desc_panel p {
        font-size: 0.9rem;
        line-height: 1.75;
        color: var(--muted2);
        margin: 0;
    }

    .frame {
        height: 86vh;
    }

    .desc_panel::before {
        content: "";
        position: absolute;
        inset: -14px; /* 让蒙版比内容大一圈 */
        pointer-events: none;

        /* 这个是关键：用渐变做“边缘淡化”的 mask 感 */
        background: radial-gradient(
            closest-side,
            rgba(0, 0, 0, 0.06),
            rgba(0, 0, 0, 0) 70%
        );
        border-radius: 18px;
    }

    .strip::after {
        content: "";
        flex: 0 0 clamp(24px, 6vw, 96px);
    }

    .strip:focus {
        outline: none;
    }

    .strip:focus-visible {
        outline: 1px solid var(--line);
        outline-offset: 2px;
    }

    /* Lightbox */
    .lightbox {
        position: fixed;
        inset: 0;
        display: none;
        z-index: 999;
    }

    .lightbox.is_open {
        display: block;
    }

    .lb_backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.82);
    }

    .lb_stage {
        position: relative;
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-columns: 64px 1fr 64px;
        align-items: center;
    }

    .lb_figure {
        margin: 0;
        display: grid;
        place-items: center;
        height: 100%;
    }

    .lb_view {
        max-width: min(92vw, 1200px);
        max-height: 86vh;
        width: auto;
        height: auto;
        object-fit: contain;
        background: rgba(255, 255, 255, 0.02);
    }

    /* Buttons */
    .lb_btn {
        appearance: none;
        border: 0;
        background: transparent;
        color: rgba(255, 255, 255, 0.86);
        font-size: 42px;
        line-height: 1;
        cursor: pointer;
        height: 64px;
        width: 64px;
        display: grid;
        place-items: center;
        user-select: none;
    }

    .lb_btn:hover {
        color: rgba(255, 255, 255, 1);
    }

    .lb_close {
        position: absolute;
        top: 18px;
        right: 18px;
        font-size: 34px;
        width: 44px;
        height: 44px;
    }

    /* Make thumbnails feel clickable (subtle) */
    .lb_img {
        cursor: zoom-in;
    }

    /* Mobile: reduce height + padding */
    @media (max-width: 720px) {
        :root {
            --strip_h: 64vh;
            --gap: 34px;
            --side_pad: 6vw;
        }
        .desc {
            padding: 40px var(--side_pad) 72px;
        }
    }
</style>

    <BaseLayout
    title={page_title}
    description={page_description}
    canonical={meta.canonical}
    ogImage={meta.og_image}
    ogType="article"
    active="reframed_still"
    breadcrumbs={breadcrumbs}>
    <div class="reframed-page">
        <p class="strip-intro-hint" aria-hidden="true">Scroll to drift through the strip · Hover for a note</p>
        <div class="strip-wrap">
        <section class="strip" id="reframed-strip" tabindex={0}>
        {
            images.map((src, idx) => (
                <figure class="frame" data-index={idx} data-hint={frameHints[idx] ?? ""}>
                    <img
                        class="lb_img"
                        src={src}
                        data-index={idx}
                        alt={`Reframed Still — frame ${idx + 1}`}
                        loading={idx < 2 ? "eager" : "lazy"}
                        decoding="async"
                    />
                </figure>
            ))
        }

        <div class="lightbox" aria-hidden="true">
            <div class="lb_backdrop" data-close="1"></div>

            <div
                class="lb_stage"
                role="dialog"
                aria-modal="true"
                aria-label="Image preview">
                <button
                    class="lb_btn lb_close"
                    type="button"
                    aria-label="Close"
                    data-close="1">×</button
                >
                <button
                    class="lb_btn lb_prev"
                    type="button"
                    aria-label="Previous">‹</button
                >

                <figure class="lb_figure">
                    <img class="lb_view" src="" alt="" />
                </figure>

                <button class="lb_btn lb_next" type="button" aria-label="Next"
                    >›</button
                >
            </div>
        </div>

        <!-- ⭐ 把 description 放这里 -->
        <article class="desc_panel">
            <h3>{project.title}</h3>

            <div class="meta">
                <div><strong>Medium:</strong> {project.medium}</div>
                <div>
                    <strong>Location:</strong>
                    {project.locations.join(", ")}
                </div>
                <div><strong>Year:</strong> {project.years}</div>
            </div>

            <script is:inline>
                (() => {
                    const imgs = Array.from(
                        document.querySelectorAll(".lb_img"),
                    );
                    const lb = document.querySelector(".lightbox");
                    const view = document.querySelector(".lb_view");
                    const prev = document.querySelector(".lb_prev");
                    const next = document.querySelector(".lb_next");
                    const closers = Array.from(
                        document.querySelectorAll("[data-close='1']"),
                    );

                    if (!imgs.length || !lb || !view || !prev || !next) return;

                    let index = 0;

                    const sources = imgs.map((img) => img.getAttribute("src"));

                    function openAt(i) {
                        index = (i + sources.length) % sources.length;
                        view.src = sources[index];
                        view.alt = `Reframed Still — frame ${index + 1}`;

                        lb.classList.add("is_open");
                        lb.setAttribute("aria-hidden", "false");
                        document.documentElement.style.overflow = "hidden"; // lock scroll
                    }

                    function close() {
                        lb.classList.remove("is_open");
                        lb.setAttribute("aria-hidden", "true");
                        view.src = "";
                        document.documentElement.style.overflow = "";
                    }

                    function step(dir) {
                        openAt(index + dir);
                    }

                    imgs.forEach((img) => {
                        img.addEventListener("click", () => {
                            const i = Number(img.dataset.index || 0);
                            openAt(i);
                        });
                    });

                    prev.addEventListener("click", () => step(-1));
                    next.addEventListener("click", () => step(1));
                    closers.forEach((el) =>
                        el.addEventListener("click", close),
                    );

                    window.addEventListener("keydown", (e) => {
                        if (lb.classList.contains("is_open")) {
                            if (e.key === "Escape") close();
                            if (e.key === "ArrowLeft") step(-1);
                            if (e.key === "ArrowRight") step(1);
                            return;
                        }

                        const strip = document.getElementById("reframed-strip");
                        if (strip && (e.key === "ArrowLeft" || e.key === "ArrowRight")) {
                            const step = 280;
                            const smooth = !window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches;
                            strip.scrollBy({
                                left: e.key === "ArrowLeft" ? -step : step,
                                behavior: smooth ? "smooth" : "auto",
                            });
                        }
                    });

                })();
            </script>

            <p>{project.note}</p>
        </article>
        </section>
        <div class="strip-hint-bar" aria-live="polite">
            <span aria-hidden="true">←</span>
            <span id="reframed-hint-text">Use ←/→ to scroll · Hover for a note</span>
            <span aria-hidden="true">→</span>
        </div>
        </div>
    </div>

    <script is:inline>
        (function reframedHintBar() {
            var hintEl = document.getElementById("reframed-hint-text");
            var strip = document.getElementById("reframed-strip");
            var defaultHint = "Use \u2190/\u2192 to scroll \u00b7 Hover for a note";
            if (!hintEl || !strip) return;
            function getFrameHint(node) {
                if (!node || !node.closest) return null;
                var frame = node.closest(".frame");
                return frame && frame.hasAttribute("data-hint") ? (frame.getAttribute("data-hint") || defaultHint) : null;
            }
            function setHint(hint) {
                hintEl.textContent = hint || defaultHint;
            }
            document.addEventListener("mouseover", function (e) {
                if (!strip.contains(e.target)) return;
                var hint = getFrameHint(e.target);
                if (hint) setHint(hint);
            });
            document.addEventListener("mouseout", function (e) {
                if (!strip.contains(e.relatedTarget)) setHint(null);
                else {
                    var hint = getFrameHint(e.relatedTarget);
                    if (hint) setHint(hint);
                    else setHint(null);
                }
            });
        })();
    </script>
</BaseLayout>
